[
    {
        "id": "e8e37342.d04c2",
        "type": "tab",
        "label": "Rescuer",
        "disabled": false,
        "info": ""
    },
    {
        "id": "4a5f8456.b9645c",
        "type": "tab",
        "label": "Rescuee",
        "disabled": false,
        "info": ""
    },
    {
        "id": "1982db49.863535",
        "type": "tab",
        "label": "Test",
        "disabled": false,
        "info": ""
    },
    {
        "id": "e6e294e0.c5c278",
        "type": "subflow",
        "name": "Get From Repo",
        "info": "Repo Parameters -> String response\nmsg.repoArgs -> msg.payload\n\nRepo Parameters = {\n    user\n    repo\n    branch\n    path\n}",
        "in": [
            {
                "x": 40,
                "y": 60,
                "wires": [
                    {
                        "id": "dc14978e.af0c68"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 500,
                "y": 60,
                "wires": [
                    {
                        "id": "2d2aee52.603722",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "5b36cca4.929894",
        "type": "subflow",
        "name": "Send To Rescuer",
        "info": "",
        "in": [
            {
                "x": 60,
                "y": 100,
                "wires": [
                    {
                        "id": "5a1a99f3.7c5818"
                    }
                ]
            }
        ],
        "out": []
    },
    {
        "id": "5e52503c.a1247",
        "type": "subflow",
        "name": "Rescuer Message Processing",
        "info": "",
        "in": [
            {
                "x": 40,
                "y": 200,
                "wires": [
                    {
                        "id": "771f583b.1f4a38"
                    }
                ]
            }
        ],
        "out": []
    },
    {
        "id": "f6f6c865.5c6f48",
        "type": "subflow",
        "name": "Generate Progress Object",
        "info": "",
        "in": [
            {
                "x": 80,
                "y": 40,
                "wires": [
                    {
                        "id": "12aec7ac.f1f308"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 420,
                "y": 40,
                "wires": [
                    {
                        "id": "12aec7ac.f1f308",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "dfcd7998.88d4b8",
        "type": "subflow",
        "name": "Send to Rescuee",
        "info": "Take payload, combine it with the payloadBackUp\n\nRemove session data\n\nConvert to json and send over websocket to Rescuee",
        "in": [
            {
                "x": 80,
                "y": 60,
                "wires": [
                    {
                        "id": "64a6e0bd.61077"
                    }
                ]
            }
        ],
        "out": []
    },
    {
        "id": "a8156bb2.565448",
        "type": "subflow",
        "name": "Rescuee Message Processing",
        "info": "",
        "in": [
            {
                "x": 60,
                "y": 120,
                "wires": [
                    {
                        "id": "373dccaa.9f9dd4"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1500,
                "y": 80,
                "wires": [
                    {
                        "id": "ae2600bd.413f3",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1160,
                "y": 200,
                "wires": [
                    {
                        "id": "e8393dd.ce1f0c",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "c317b25.fe6aa5",
        "type": "subflow",
        "name": "Prepare Data for Sending",
        "info": "",
        "in": [
            {
                "x": 40,
                "y": 100,
                "wires": [
                    {
                        "id": "4916a862.255488"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 780,
                "y": 100,
                "wires": [
                    {
                        "id": "2d5fed7e.04abd2",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "148c3991.b9c716",
        "type": "subflow",
        "name": "Retrieve Config & Generate Progress Object",
        "info": "",
        "in": [
            {
                "x": 60,
                "y": 60,
                "wires": [
                    {
                        "id": "552b103b.56051"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1300,
                "y": 60,
                "wires": [
                    {
                        "id": "7375e38c.2f59fc",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "6f3a8a65.85c414",
        "type": "subflow",
        "name": "(Text -> Speech) to Rescuee",
        "info": "",
        "in": [
            {
                "x": 140,
                "y": 140,
                "wires": [
                    {
                        "id": "e91f9532.bd3578"
                    },
                    {
                        "id": "4c788300.90976c"
                    }
                ]
            }
        ],
        "out": []
    },
    {
        "id": "24110b62.cac5b4",
        "type": "websocket-listener",
        "z": "",
        "path": "/ws/messagereceive",
        "wholemsg": "false"
    },
    {
        "id": "1137bdd2.fb05a2",
        "type": "websocket-client",
        "z": "",
        "path": "/ws/messagepublish",
        "tls": "",
        "wholemsg": "false"
    },
    {
        "id": "dfde61ff.4b109",
        "type": "websocket-client",
        "z": "dfcd7998.88d4b8",
        "path": "ws://rescueeclient.eu-gb.mybluemix.net/ws/fromServer",
        "tls": "",
        "wholemsg": "false"
    },
    {
        "id": "d9b33300.6e82b",
        "type": "websocket-listener",
        "z": "",
        "path": "/ws/ToServer",
        "wholemsg": "false"
    },
    {
        "id": "47a761e2.5bc45",
        "type": "http in",
        "z": "e8e37342.d04c2",
        "name": "Serve Web pages from Git",
        "url": "/web/:file",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 140,
        "wires": [
            [
                "aedc7c6a.6e628",
                "3c9231e6.14fe7e"
            ]
        ]
    },
    {
        "id": "aedc7c6a.6e628",
        "type": "debug",
        "z": "e8e37342.d04c2",
        "name": "File request",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "req.params",
        "x": 350,
        "y": 180,
        "wires": []
    },
    {
        "id": "2d2aee52.603722",
        "type": "http request",
        "z": "e6e294e0.c5c278",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "",
        "tls": "",
        "x": 370,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "6e0e671f.6ec3f8",
        "type": "subflow:e6e294e0.c5c278",
        "z": "e8e37342.d04c2",
        "name": "",
        "x": 560,
        "y": 140,
        "wires": [
            [
                "7ebca494.4f69ec"
            ]
        ]
    },
    {
        "id": "3c9231e6.14fe7e",
        "type": "change",
        "z": "e8e37342.d04c2",
        "name": "Repo Params",
        "rules": [
            {
                "t": "set",
                "p": "repoArgs",
                "pt": "msg",
                "to": "{\"user\":\"andrewstanton94\",\"repo\":\"space\",\"branch\":\"master\",\"path\":\"web\"}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "repoArgs.file",
                "pt": "msg",
                "to": "req.params.file",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 140,
        "wires": [
            [
                "6e0e671f.6ec3f8"
            ]
        ]
    },
    {
        "id": "dc14978e.af0c68",
        "type": "function",
        "z": "e6e294e0.c5c278",
        "name": "Generate URL",
        "func": "const {\n    user,\n    repo,\n    branch,\n    path,\n    file\n} = msg.repoArgs;\n\nmsg.url = `https://raw.githubusercontent.com/${user}/${repo}/${branch}/${path}/${file}`;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 180,
        "y": 60,
        "wires": [
            [
                "2d2aee52.603722"
            ]
        ],
        "inputLabels": [
            "Repo Info"
        ],
        "outputLabels": [
            "URL"
        ]
    },
    {
        "id": "dc95e929.fae528",
        "type": "http response",
        "z": "e8e37342.d04c2",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1090,
        "y": 180,
        "wires": []
    },
    {
        "id": "7ebca494.4f69ec",
        "type": "switch",
        "z": "e8e37342.d04c2",
        "name": "Type router",
        "property": "req.params.file",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "css",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "js",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 750,
        "y": 140,
        "wires": [
            [
                "489b9894.d12b68"
            ],
            [
                "988fa62b.1f2928"
            ],
            [
                "dc95e929.fae528"
            ]
        ],
        "outputLabels": [
            "css",
            "js",
            "other"
        ]
    },
    {
        "id": "489b9894.d12b68",
        "type": "change",
        "z": "e8e37342.d04c2",
        "name": "Type:css",
        "rules": [
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{\"Content-Type\":\"text/css\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 100,
        "wires": [
            [
                "dc95e929.fae528"
            ]
        ]
    },
    {
        "id": "988fa62b.1f2928",
        "type": "change",
        "z": "e8e37342.d04c2",
        "name": "Type:js",
        "rules": [
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{\"Content-Type\":\"text/javascript\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 140,
        "wires": [
            [
                "dc95e929.fae528"
            ]
        ]
    },
    {
        "id": "5b2ae056.62d37",
        "type": "websocket in",
        "z": "e8e37342.d04c2",
        "name": "WS From Rescuer",
        "server": "24110b62.cac5b4",
        "client": "",
        "x": 150,
        "y": 280,
        "wires": [
            [
                "f021b3d.640a95"
            ]
        ]
    },
    {
        "id": "567b53eb.ee0b1c",
        "type": "debug",
        "z": "e8e37342.d04c2",
        "name": "Message from Rescuer",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 530,
        "y": 320,
        "wires": []
    },
    {
        "id": "d65c21ca.e21a",
        "type": "websocket out",
        "z": "5b36cca4.929894",
        "name": "To Rescuer",
        "server": "",
        "client": "1137bdd2.fb05a2",
        "x": 450,
        "y": 100,
        "wires": []
    },
    {
        "id": "4e5320a1.079c7",
        "type": "inject",
        "z": "e8e37342.d04c2",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 180,
        "y": 400,
        "wires": [
            [
                "dadc7d48.4a037"
            ]
        ]
    },
    {
        "id": "dadc7d48.4a037",
        "type": "subflow:5b36cca4.929894",
        "z": "e8e37342.d04c2",
        "name": "",
        "x": 370,
        "y": 400,
        "wires": []
    },
    {
        "id": "eac1e558.cb4e18",
        "type": "switch",
        "z": "5e52503c.a1247",
        "name": "Rescuer Router",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "$exists(payload.start)",
                "vt": "jsonata"
            },
            {
                "t": "jsonata_exp",
                "v": "$exists(payload.message)",
                "vt": "jsonata"
            },
            {
                "t": "jsonata_exp",
                "v": "$exists(payload.progress)",
                "vt": "jsonata"
            },
            {
                "t": "jsonata_exp",
                "v": "$exists(payload.stateChanged)",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 380,
        "y": 200,
        "wires": [
            [
                "77a4637c.dce72c"
            ],
            [
                "6664a3f5.b842bc"
            ],
            [
                "76283e4c.59d42"
            ],
            [
                "5c2291b0.fb766"
            ]
        ],
        "outputLabels": [
            "Start",
            "Text Message",
            "Check answers",
            "State Changed"
        ]
    },
    {
        "id": "b3844845.6c6f38",
        "type": "subflow:5e52503c.a1247",
        "z": "e8e37342.d04c2",
        "name": "",
        "x": 550,
        "y": 280,
        "wires": []
    },
    {
        "id": "552b103b.56051",
        "type": "change",
        "z": "148c3991.b9c716",
        "name": "Repo Params",
        "rules": [
            {
                "t": "set",
                "p": "repoArgs",
                "pt": "msg",
                "to": "{\"user\":\"andrewstanton94\",\"repo\":\"space\",\"branch\":\"master\",\"path\":\"config\",\"file\":\"quickRescue.json\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 220,
        "y": 60,
        "wires": [
            [
                "bceba480.fc9c78"
            ]
        ]
    },
    {
        "id": "bceba480.fc9c78",
        "type": "subflow:e6e294e0.c5c278",
        "z": "148c3991.b9c716",
        "name": "",
        "x": 420,
        "y": 60,
        "wires": [
            [
                "42325447.f405cc"
            ]
        ]
    },
    {
        "id": "42325447.f405cc",
        "type": "json",
        "z": "148c3991.b9c716",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 590,
        "y": 60,
        "wires": [
            [
                "42c4d35.665222c"
            ]
        ]
    },
    {
        "id": "741fe9fb.939d58",
        "type": "subflow:5b36cca4.929894",
        "z": "5e52503c.a1247",
        "name": "",
        "x": 1150,
        "y": 40,
        "wires": []
    },
    {
        "id": "f021b3d.640a95",
        "type": "json",
        "z": "e8e37342.d04c2",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 330,
        "y": 280,
        "wires": [
            [
                "567b53eb.ee0b1c",
                "b3844845.6c6f38"
            ]
        ]
    },
    {
        "id": "7375e38c.2f59fc",
        "type": "subflow:f6f6c865.5c6f48",
        "z": "148c3991.b9c716",
        "name": "",
        "x": 1130,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "12aec7ac.f1f308",
        "type": "function",
        "z": "f6f6c865.5c6f48",
        "name": "Populate Progress Object",
        "func": "// For each act create an array for each scene\nconst generateResultStructure = (act) => Array(act.scenes.length);\n\nmsg.payload.progress = {\n    act: 0,\n    scene: 0,\n    imgClasses: msg.payload.gameDescription.acts.map(generateResultStructure),\n    selectedClasses: msg.payload.gameDescription.acts.map(generateResultStructure)\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "53c5c47c.d198cc",
        "type": "websocket in",
        "z": "4a5f8456.b9645c",
        "name": "From Rescuees",
        "server": "d9b33300.6e82b",
        "client": "",
        "x": 120,
        "y": 180,
        "wires": [
            [
                "291c32bb.a25dee"
            ]
        ]
    },
    {
        "id": "ece5413.34be8c",
        "type": "websocket out",
        "z": "dfcd7998.88d4b8",
        "name": "To Rescuee",
        "server": "",
        "client": "dfde61ff.4b109",
        "x": 470,
        "y": 60,
        "wires": []
    },
    {
        "id": "9832b1f0.aa084",
        "type": "switch",
        "z": "a8156bb2.565448",
        "name": "RescueeRouter",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "$exists(payload.speech)",
                "vt": "jsonata"
            },
            {
                "t": "jsonata_exp",
                "v": "$exists(payload.img)",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 400,
        "y": 120,
        "wires": [
            [
                "9cc313fc.d44e1"
            ],
            [
                "857c9a.dfb45368"
            ]
        ],
        "outputLabels": [
            "Voice",
            "Image"
        ]
    },
    {
        "id": "291c32bb.a25dee",
        "type": "json",
        "z": "4a5f8456.b9645c",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 290,
        "y": 180,
        "wires": [
            [
                "738ba1ea.c13dd",
                "57aab339.3996cc"
            ]
        ]
    },
    {
        "id": "373dccaa.9f9dd4",
        "type": "change",
        "z": "a8156bb2.565448",
        "name": "Backup payload",
        "rules": [
            {
                "t": "set",
                "p": "payloadBackup",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 200,
        "y": 120,
        "wires": [
            [
                "9832b1f0.aa084"
            ]
        ]
    },
    {
        "id": "9cc313fc.d44e1",
        "type": "change",
        "z": "a8156bb2.565448",
        "name": "Move Speech",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.speech",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "moveTo",
                "pt": "msg",
                "to": "transcription",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 600,
        "y": 80,
        "wires": [
            [
                "6088b9d2.5841e",
                "75b61d31.c828a4"
            ]
        ]
    },
    {
        "id": "f96ab4b.fb7ba48",
        "type": "visual-recognition-v3",
        "z": "a8156bb2.565448",
        "name": "",
        "apikey": "__PWRD__",
        "image-feature": "classifyImage",
        "lang": "en",
        "x": 790,
        "y": 200,
        "wires": [
            [
                "e8393dd.ce1f0c"
            ]
        ]
    },
    {
        "id": "738ba1ea.c13dd",
        "type": "debug",
        "z": "4a5f8456.b9645c",
        "name": "Message from Rescuee",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 490,
        "y": 220,
        "wires": []
    },
    {
        "id": "48900843.f082b8",
        "type": "watson-speech-to-text",
        "z": "a8156bb2.565448",
        "name": "",
        "alternatives": 1,
        "speakerlabels": false,
        "smartformatting": false,
        "lang": "en-GB",
        "langhidden": "en-GB",
        "langcustom": "NoCustomisationSetting",
        "langcustomhidden": "",
        "band": "NarrowbandModel",
        "bandhidden": "",
        "password": "LKjWHdqdFBgg",
        "payload-response": true,
        "streaming-mode": false,
        "streaming-mute": true,
        "discard-listening": false,
        "default-endpoint": true,
        "service-endpoint": "https://stream.watsonplatform.net/speech-to-text/api",
        "x": 1000,
        "y": 80,
        "wires": [
            [
                "3d6d858b.999942"
            ]
        ]
    },
    {
        "id": "9363bc1b.a6e72",
        "type": "function",
        "z": "c317b25.fe6aa5",
        "name": "Make the data accessible",
        "func": "// Put data that overwrites the payload into the existing structure\n// Using the set payload option makes the code more consistent\n// Fixed location -> variable location NOT Variable -> Variable\nmsg.payloadBackup[msg.moveTo] = msg.payload;\n\n// Removes all other content\n// Functionally equivalent to deleting _session\nreturn {payload: msg.payloadBackup};",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 60,
        "wires": [
            [
                "2d5fed7e.04abd2"
            ]
        ]
    },
    {
        "id": "4916a862.255488",
        "type": "switch",
        "z": "c317b25.fe6aa5",
        "name": "Need to restore data",
        "property": "moveTo",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 220,
        "y": 100,
        "wires": [
            [
                "9363bc1b.a6e72"
            ],
            [
                "9612cbf8.2e7bc8"
            ]
        ],
        "outputLabels": [
            "Data restoration needed",
            "Simple case"
        ]
    },
    {
        "id": "9612cbf8.2e7bc8",
        "type": "change",
        "z": "c317b25.fe6aa5",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "_session",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 140,
        "wires": [
            [
                "2d5fed7e.04abd2"
            ]
        ]
    },
    {
        "id": "57aab339.3996cc",
        "type": "subflow:a8156bb2.565448",
        "z": "4a5f8456.b9645c",
        "name": "",
        "x": 510,
        "y": 180,
        "wires": [
            [
                "9c899a90.843af8",
                "dad46e0.cdadd9"
            ],
            [
                "9c899a90.843af8",
                "854ff5b.a50b708"
            ]
        ],
        "outputLabels": [
            "Speech To Text",
            "Image To Image Classes"
        ]
    },
    {
        "id": "9c899a90.843af8",
        "type": "subflow:5b36cca4.929894",
        "z": "4a5f8456.b9645c",
        "name": "",
        "x": 890,
        "y": 180,
        "wires": []
    },
    {
        "id": "dad46e0.cdadd9",
        "type": "debug",
        "z": "4a5f8456.b9645c",
        "name": "Speech To Text",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "x": 740,
        "y": 140,
        "wires": []
    },
    {
        "id": "854ff5b.a50b708",
        "type": "debug",
        "z": "4a5f8456.b9645c",
        "name": "Img to Classes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 740,
        "y": 220,
        "wires": []
    },
    {
        "id": "e91f9532.bd3578",
        "type": "watson-text-to-speech",
        "z": "6f3a8a65.85c414",
        "name": "",
        "lang": "en-GB",
        "langhidden": "en-GB",
        "langcustom": "NoCustomisationSetting",
        "langcustomhidden": "",
        "voice": "en-GB_KateVoice",
        "voicehidden": "",
        "format": "audio/wav",
        "password": "gBEJxPm6x1R4",
        "payload-response": true,
        "default-endpoint": true,
        "service-endpoint": "https://stream.watsonplatform.net/text-to-speech/api",
        "x": 300,
        "y": 140,
        "wires": [
            [
                "e404deec.5fceb"
            ]
        ]
    },
    {
        "id": "771f583b.1f4a38",
        "type": "change",
        "z": "5e52503c.a1247",
        "name": "Backup payload",
        "rules": [
            {
                "t": "set",
                "p": "payloadBackup",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 180,
        "y": 200,
        "wires": [
            [
                "eac1e558.cb4e18"
            ]
        ]
    },
    {
        "id": "6664a3f5.b842bc",
        "type": "change",
        "z": "5e52503c.a1247",
        "name": "Move Text",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.message.msg",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 200,
        "wires": [
            [
                "303e1dda.1bf472"
            ]
        ]
    },
    {
        "id": "5a1a99f3.7c5818",
        "type": "subflow:c317b25.fe6aa5",
        "z": "5b36cca4.929894",
        "name": "",
        "x": 230,
        "y": 100,
        "wires": [
            [
                "d65c21ca.e21a",
                "4eb7bb16.ffc7a4"
            ]
        ]
    },
    {
        "id": "e404deec.5fceb",
        "type": "change",
        "z": "6f3a8a65.85c414",
        "name": "moveTo = speech",
        "rules": [
            {
                "t": "set",
                "p": "moveTo",
                "pt": "msg",
                "to": "speech",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 140,
        "wires": [
            [
                "21469e96.977e82",
                "8821b125.aed82"
            ]
        ]
    },
    {
        "id": "21469e96.977e82",
        "type": "subflow:dfcd7998.88d4b8",
        "z": "6f3a8a65.85c414",
        "name": "",
        "x": 730,
        "y": 140,
        "wires": []
    },
    {
        "id": "8821b125.aed82",
        "type": "debug",
        "z": "6f3a8a65.85c414",
        "name": "post textToSpeech",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "x": 730,
        "y": 180,
        "wires": []
    },
    {
        "id": "d50f5fb.c49a9a",
        "type": "debug",
        "z": "5e52503c.a1247",
        "name": "Rescuer Intro",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "x": 1140,
        "y": 80,
        "wires": []
    },
    {
        "id": "77a4637c.dce72c",
        "type": "subflow:148c3991.b9c716",
        "z": "5e52503c.a1247",
        "name": "",
        "x": 685,
        "y": 80,
        "wires": [
            [
                "85f2a875.40dbe8"
            ]
        ]
    },
    {
        "id": "857c9a.dfb45368",
        "type": "function",
        "z": "a8156bb2.565448",
        "name": "Extract Img",
        "func": "msg.payload = Buffer.from(msg.payload.img);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 590,
        "y": 200,
        "wires": [
            [
                "f96ab4b.fb7ba48"
            ]
        ]
    },
    {
        "id": "7e6cb876.154998",
        "type": "join",
        "z": "1982db49.863535",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 550,
        "y": 160,
        "wires": [
            [
                "a3464495.ba0408"
            ]
        ]
    },
    {
        "id": "cd45a1a0.bae1e",
        "type": "inject",
        "z": "1982db49.863535",
        "name": "",
        "topic": "",
        "payload": "{\"payload\":\"fdjksalflaksjdkl\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 140,
        "wires": [
            [
                "49b1b538.6059fc"
            ]
        ]
    },
    {
        "id": "a3464495.ba0408",
        "type": "debug",
        "z": "1982db49.863535",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 690,
        "y": 160,
        "wires": []
    },
    {
        "id": "521fab87.3a2514",
        "type": "debug",
        "z": "1982db49.863535",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 450,
        "y": 120,
        "wires": []
    },
    {
        "id": "6162b475.bcf9cc",
        "type": "inject",
        "z": "1982db49.863535",
        "name": "",
        "topic": "",
        "payload": "{\"payload\":\"fklkllkklkljkljlk\"}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 180,
        "wires": [
            [
                "973c1993.a2af78"
            ]
        ]
    },
    {
        "id": "973c1993.a2af78",
        "type": "change",
        "z": "1982db49.863535",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "blunder",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 180,
        "wires": [
            [
                "7e6cb876.154998",
                "36be3003.4c473"
            ]
        ]
    },
    {
        "id": "49b1b538.6059fc",
        "type": "change",
        "z": "1982db49.863535",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "goof",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 140,
        "wires": [
            [
                "7e6cb876.154998",
                "521fab87.3a2514"
            ]
        ]
    },
    {
        "id": "36be3003.4c473",
        "type": "debug",
        "z": "1982db49.863535",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 450,
        "y": 200,
        "wires": []
    },
    {
        "id": "42c4d35.665222c",
        "type": "change",
        "z": "148c3991.b9c716",
        "name": "payload -> payload.gameDescription",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.gameDescription",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 60,
        "wires": [
            [
                "7375e38c.2f59fc",
                "1a6c917d.dd318f"
            ]
        ]
    },
    {
        "id": "64a6e0bd.61077",
        "type": "subflow:c317b25.fe6aa5",
        "z": "dfcd7998.88d4b8",
        "name": "",
        "x": 250,
        "y": 60,
        "wires": [
            [
                "ece5413.34be8c"
            ]
        ]
    },
    {
        "id": "e8393dd.ce1f0c",
        "type": "change",
        "z": "a8156bb2.565448",
        "name": "Send imgClasses",
        "rules": [
            {
                "t": "set",
                "p": "imgClasses",
                "pt": "msg",
                "to": "result.images.classifiers.classes",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payloadBackp",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.imgClasses",
                "pt": "msg",
                "to": "imgClasses",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1010,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "2d5fed7e.04abd2",
        "type": "json",
        "z": "c317b25.fe6aa5",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 670,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "1a6c917d.dd318f",
        "type": "debug",
        "z": "148c3991.b9c716",
        "name": "gameDescription",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 1110,
        "y": 100,
        "wires": []
    },
    {
        "id": "76283e4c.59d42",
        "type": "function",
        "z": "5e52503c.a1247",
        "name": "Extract Classes",
        "func": "let {\n    act,\n    selectedClasses\n} = msg.payload.progress;\n\nlet selectedClassesForAct = selectedClasses[act];\nlet expectedClassesForAct = msg.payload.gameDescription.acts[act].scenes.map(scene => scene.acceptanceCriteria);\n\nmsg.selectedClassesForAct = selectedClassesForAct;\nmsg.expectedClassesForAct = expectedClassesForAct;\nmsg.currentAct = act;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 600,
        "y": 380,
        "wires": [
            [
                "6725e0d8.056ef",
                "f5b2cd41.3a3e5"
            ]
        ]
    },
    {
        "id": "6725e0d8.056ef",
        "type": "debug",
        "z": "5e52503c.a1247",
        "name": "Extracted Classes",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 810,
        "y": 440,
        "wires": []
    },
    {
        "id": "f5b2cd41.3a3e5",
        "type": "function",
        "z": "5e52503c.a1247",
        "name": "Validate Responses",
        "func": "let {\n    selectedClassesForAct: selected,\n    expectedClassesForAct: expected,\n    currentAct\n} = msg;\n\nlet result;\n\nif (selected.length !== expected.length || selected.includes(null)){\n    result = \"Incomplete\";\n}\nelse {\n    let matches = selected.map((sceneSelected, i) => sceneSelected === expected[i])   // Check each scene\n        .reduce((acc, current) => acc && current);  // Do they all match\n        \n    if (matches){\n        let numberOfActs = msg.payload.gameDescription.acts.length;\n        if ((currentAct + 1) < numberOfActs) {\n            result = \"Progression\";\n        }\n        else {\n            result = \"Complete\"\n        }\n    }\n    else {\n        result = \"Don't match\"\n    }\n}\n\nmsg.result = result;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 810,
        "y": 380,
        "wires": [
            [
                "1a856c4a.4a1704",
                "96027b81.c24be8"
            ]
        ]
    },
    {
        "id": "1a856c4a.4a1704",
        "type": "debug",
        "z": "5e52503c.a1247",
        "name": "Answers match",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1040,
        "y": 480,
        "wires": []
    },
    {
        "id": "96027b81.c24be8",
        "type": "switch",
        "z": "5e52503c.a1247",
        "name": "Validation Router",
        "property": "result",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Incomplete",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Progression",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Don't match",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Complete",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1030,
        "y": 380,
        "wires": [
            [],
            [
                "63ed0a82.a83f04"
            ],
            [
                "a73c3f58.4df63"
            ],
            [
                "7dc8c4c6.9da18c"
            ]
        ],
        "outputLabels": [
            "Not all scenes have an answer",
            "Move to next scene",
            "Not all scenes match",
            "Game complete"
        ]
    },
    {
        "id": "a73c3f58.4df63",
        "type": "change",
        "z": "5e52503c.a1247",
        "name": "Wrong Answers",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payloadBackup.gameDescription.failureMessage",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1240,
        "y": 380,
        "wires": [
            [
                "317d5f.4cf112a2"
            ]
        ]
    },
    {
        "id": "63ed0a82.a83f04",
        "type": "change",
        "z": "5e52503c.a1247",
        "name": "Progress",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payloadBackup.gameDescription.successMessage",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1220,
        "y": 340,
        "wires": [
            [
                "21b434a.1f449cc",
                "317d5f.4cf112a2"
            ]
        ]
    },
    {
        "id": "7dc8c4c6.9da18c",
        "type": "change",
        "z": "5e52503c.a1247",
        "name": "Finished",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "You have finished",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1220,
        "y": 420,
        "wires": [
            [
                "317d5f.4cf112a2"
            ]
        ]
    },
    {
        "id": "303e1dda.1bf472",
        "type": "subflow:6f3a8a65.85c414",
        "z": "5e52503c.a1247",
        "name": "",
        "x": 820,
        "y": 200,
        "wires": []
    },
    {
        "id": "4c788300.90976c",
        "type": "debug",
        "z": "6f3a8a65.85c414",
        "name": "pre textToSpeech",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "x": 310,
        "y": 180,
        "wires": []
    },
    {
        "id": "21b434a.1f449cc",
        "type": "function",
        "z": "5e52503c.a1247",
        "name": "New Act",
        "func": "let progress = msg.payloadBackup.progress;\nlet gameDescription = msg.payloadBackup.gameDescription\n\nprogress.act = progress.act + 1;\nprogress.scene = 0;\n\nmsg.payload = {progress, gameDescription};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1380,
        "y": 320,
        "wires": [
            [
                "733f9b0e.1552c4"
            ]
        ]
    },
    {
        "id": "317d5f.4cf112a2",
        "type": "subflow:6f3a8a65.85c414",
        "z": "5e52503c.a1247",
        "x": 1600,
        "y": 380,
        "wires": []
    },
    {
        "id": "3d6d858b.999942",
        "type": "sentiment",
        "z": "a8156bb2.565448",
        "name": "",
        "property": "payload",
        "x": 1180,
        "y": 80,
        "wires": [
            [
                "ae2600bd.413f3"
            ]
        ]
    },
    {
        "id": "ae2600bd.413f3",
        "type": "change",
        "z": "a8156bb2.565448",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t       \"message\": payload,\t       \"sentiment\": sentiment\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1360,
        "y": 80,
        "wires": [
            [
                "db7ad591.ca99f"
            ]
        ]
    },
    {
        "id": "db7ad591.ca99f",
        "type": "debug",
        "z": "a8156bb2.565448",
        "name": "Sentiment transcription",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1580,
        "y": 120,
        "wires": []
    },
    {
        "id": "6088b9d2.5841e",
        "type": "function",
        "z": "a8156bb2.565448",
        "name": "Array to buffer",
        "func": "msg.payload = Buffer.from(msg.payload);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 800,
        "y": 80,
        "wires": [
            [
                "48900843.f082b8"
            ]
        ]
    },
    {
        "id": "75b61d31.c828a4",
        "type": "debug",
        "z": "a8156bb2.565448",
        "name": "Speech",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 780,
        "y": 120,
        "wires": []
    },
    {
        "id": "85f2a875.40dbe8",
        "type": "change",
        "z": "5e52503c.a1247",
        "name": "gameIntro",
        "rules": [
            {
                "t": "set",
                "p": "payload.transcription",
                "pt": "msg",
                "to": "{\t    \"sentiment\": {\t        \"score\": 0\t    },\t    \"message\" : payload.gameDescription.gameIntro\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 80,
        "wires": [
            [
                "741fe9fb.939d58",
                "d50f5fb.c49a9a",
                "50593536.d3f96c"
            ]
        ]
    },
    {
        "id": "50593536.d3f96c",
        "type": "change",
        "z": "5e52503c.a1247",
        "name": "prepare voiceover",
        "rules": [
            {
                "t": "move",
                "p": "payload.transcription.message",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1150,
        "y": 120,
        "wires": [
            [
                "4a4492a4.3440ec"
            ]
        ]
    },
    {
        "id": "4a4492a4.3440ec",
        "type": "subflow:6f3a8a65.85c414",
        "z": "5e52503c.a1247",
        "name": "",
        "x": 1400,
        "y": 120,
        "wires": []
    },
    {
        "id": "5c2291b0.fb766",
        "type": "function",
        "z": "5e52503c.a1247",
        "name": "Extract sceneIntro",
        "func": "let {progress, gameDescription} = msg.payload;\nlet {act, scene: currentScene} = progress;\nlet sceneIntro = gameDescription.acts[act].scenes[currentScene].sceneIntro;\n\nmsg.payload = sceneIntro;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 610,
        "y": 540,
        "wires": [
            [
                "8159997e.e7a478",
                "57956389.1af694"
            ]
        ]
    },
    {
        "id": "8159997e.e7a478",
        "type": "subflow:6f3a8a65.85c414",
        "z": "5e52503c.a1247",
        "name": "",
        "x": 860,
        "y": 540,
        "wires": []
    },
    {
        "id": "57956389.1af694",
        "type": "debug",
        "z": "5e52503c.a1247",
        "name": "Scene intro",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 810,
        "y": 580,
        "wires": []
    },
    {
        "id": "733f9b0e.1552c4",
        "type": "subflow:5b36cca4.929894",
        "z": "5e52503c.a1247",
        "name": "",
        "x": 1570,
        "y": 320,
        "wires": []
    },
    {
        "id": "4eb7bb16.ffc7a4",
        "type": "debug",
        "z": "5b36cca4.929894",
        "name": "To Rescuer",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 450,
        "y": 140,
        "wires": []
    }
]
